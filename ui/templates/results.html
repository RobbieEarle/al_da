{% extends "base.html" %}

{% block results %}

    <div id="results_scroll_to" class="section-break"></div>
        <br />
        <br />

    <section id="results" uib-collapse="!show_results" ng-controller="ResultsController">

        <section id="resultsHeader" class="container container-with-overflow">
            <div class="section-header font-mont-400">
                <b>Scan Results</b>
            </div>
        </section>
        <div ng-if="scan_success" id="resultPass" class="container container-with-overflow pad bg-green">
            <div class="failure-split-left">
                <div class="section-subheader font-mont-400">
                    <b>No malware was detected on this device</b>
                </div>
                <div class="failure_message text-semi-muted font-mont-400">
                    //pass_message//
                </div>
            </div>
            <div class="failure-split-right">
                <img class="failure-img" src="/static/images/result_pass.svg">
            </div>
        </div>
        <div ng-if="!scan_success" id="resultFail" class="container container-with-overflow pad bg-red">
            <div class="failure-split-left">
                <div class="section-subheader font-mont-400">
                    <b>Warning: Malware has been detected on this device</b>
                </div>
                <div class="failure_message text-semi-muted font-mont-400">
                    //failure_message//
                </div>
            </div>

            <div class="failure-split-right">
                <img class="failure-img" src="/static/images/result_failure.svg">
            </div>

        </div>

        <section id="results_body" role="main" class="container container-with-overflow">

            <div class="pad-head">
                <div uib-accordion close-others="true" class="pad table text-semi-muted" ng-if="!scan_success" uib-collapse="clear_results">
                    <p><b>Potentially malicious files</b></p>
                    <div uib-accordion-group ng-repeat="file in tbl_mal_files | orderBy : '-submission.max_score'" class="panel-danger">

                        <div uib-accordion-heading>
                            <div class="row mal_file_header">
                                <div class="cellHead">//file.submission.metadata.filename//</div>
                                <div class="cellHead text-right">//file.submission.max_score//</div>
                            </div>
                        </div>

                        <div class="pad">
                            <p><b>Path:</b> //file.submission.metadata.path//</p>
                            <!--<p><b>SID:</b> //file.submission.sid//</p>-->
                        </div>

                        <div class="pad"><b>File Contents:</b></div>

                        <script type="text/ng-template" id="file_tree">
                            <div ng-if="file_child.score>=500">
                                <div ng-click="isCollapsed = !isCollapsed" class="results-title">
                                    <span ng-if="isCollapsed" class="fas fa-chevron-circle-right results-glyph" style="display:inline"></span>
                                    <span ng-if="!isCollapsed" class="fas fa-chevron-circle-down results-glyph" style="display:inline"></span>
                                    <p style="display:inline" ng-class="{'results-alert': file_child.score>=500, 'results-safe': file_child.result.score<500}"><b>//file_child.score//</b></p>
                                    <p style="display:inline">  ::  //nameStrip(file_child.name)//</p>
                                </div>

                                <div class="collapse-pad">
                                    <div uib-collapse="isCollapsed" ng-init="isCollapsed=true">
                                        <div ng-repeat="result in file.results">
                                            <div class="results-detail" ng-if="key==result.srl && result.result.score>0">
                                                <div class="results-title" ng-click="serviceInfo(result.response.service_name)" ng-controller="serviceController">
                                                    <p style="display:inline" ng-class="{'results-alert': result.result.score>=500, 'results-safe': result.result.score<500}"><b>//result.result.score//</b></p>
                                                    <p style="display:inline"><b>  ::  //result.response.service_name//</b></p>
                                                </div>
                                                <div ng-repeat="detail in result.result.sections" class="results-detail2">
                                                    <p style="display:inline" ng-class="{'results-alert': detail.score>=500, 'results-safe': detail.score<500}"><b>//detail.score//</b></p>
                                                    <p style="display:inline">  ::  //detail.title_text//</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div ng-if="file_child.children">
                                <div ng-repeat="(key, file_child) in file_child.children" ng-include="'file_tree'"></div>
                            </div>

                        </script>
                        <div ng-repeat="(key, file_child) in file.file_tree" ng-include="'file_tree'"></div>

                    </div>
                </div>

                <div uib-accordion close-others="true" class="pad table text-semi-muted" uib-collapse="clear_results">
                    <p ng-if="show_pass_header"><b>Safe files</b></p>
                    <div uib-accordion-group ng-repeat="file in tbl_pass_files | orderBy : '-metadata.al_score'" class="panel-default">

                        <div uib-accordion-heading>
                            <div class="row text-semi-muted">
                                <div class="cellHead">//file.metadata.filename//</div>
                                <div class="cellHead text-right">//file.metadata.al_score//</div>
                            </div>
                        </div>

                        <div class="pad">
                            <p><b>Path:</b> //file.metadata.path//</p>
                            <!--<p><b>SID:</b> //file.alert.sid//</p>-->
                        </div>

                    </div>
                </div>
            </div>

        </section>
    </section>
{% endblock %}